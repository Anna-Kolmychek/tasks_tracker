# Проект "Трекер задач сотрудников"  

## Общее назначение
Сервис создан для создания, хранения, обновления и отслеживания задач сотрудников.
А также выполняет отчетные выборки по занятым сотрудникам и важным задачам.

<hr>

## Запуск проекта

1. Клонируйте исходники проекта:
```
git clone git@github.com:Anna-Kolmychek/tasks_tracker.git
```
ИЛИ
```
git clone https://github.com/Anna-Kolmychek/tasks_tracker.git
```

2. Создайте файл `.env` и запишите в него параметры для баз данных (основной и тестовой).
Пример структуры файла в `.env_sample`


3. Запустите проект с помощью docker-compose
```
docker-compose up --build
```

4. При желании загрузите тестовый набор данных в основную БД

```
docker exec -i postgres_db psql -U __пользователь БД__ -d __имя БД__ < db_data.dump
```

5. При желании можете запустить тесты и узнать покрытие
```
docker-compose exec app pytest --cov
```

<hr>

## Функциональность

Данные в сервисе основаны на 3 связанных друг с другом сущностях:
Должность, Сотрудник, Задача. Для каждой сущности реализован механизм CRUD.

Эндпоинты основаны на (индивидуальной для сущности) префиксе и разным методах запроса:
- `post('/префикс/')` - создать новый объект
- `get('/префикс/')` - получить список всех объектов
- `get('/префикс/{id}')` - получить объект по id
- `put('/префикс/{id}')` - полностью обновить объект по id (обновляются все поля, даже если их не передали в теле запроса)
- `patch('/префикс/{id}')` - частично обновить объект по id (обновляются только те поля, которые передали в теле запроса)
- `delete('/префикс/{id}')` - удалить объект по id

### Должность
Содержит поля
- Обязательные
  - название (title)

При создании и обновлении должности стоит запрет на создание двух должностей с одинаковым названием.

Эндпоинты CRUD реализованы по префиксу `/positions/`


### Сотрудник
Содержит поля
- Обязательные
  - почта (email)
  - пароль (password)
- Опциональные
  - имя (firstname)
  - фамилия (lastname)
  - id должности (position_id)

При создании и обновлении сотрудника стоит запрет на создание двух сотрудников с одинаковой почтой.

При создании и обновлении сотрудника должность вводится тестом, затем программно меняется на соответствующий id.
Если введенной должности нет, считается, что должность не задана.

Эндпоинты CRUD реализованы по префиксу `/users/`


### Задача
Содержит поля
- Обязательные
  - название (title)
- Опциональные
  - описание (description)
  - статус (status)
  - срок выполнения (deadline)
  - родительская задача (parent_task_id)
  - исполнитель (maker_id)
  - должность исполнителя (maker_position_id)

При создании и обновлении задачи стоит запрет на указание несуществующих родительской задачи, исполнителя, должности исполнителя.

Статус задачи может принимать только три значения: new, in work, closed.
Если статус не задан, ему автоматически присваивается значение new. 

Эндпоинты CRUD реализованы по префиксу `/tasks/`

### Связи сущностей
Сущности связаны между собой через автоматически создаваемые поля:
- Должность
  - должность с сотрудником - через `users` (список)
  - должность с задачей - через `tasks` (список)
- Сотрудник
  - сотрудник с должностью - через `position`
  - сотрудник с задачами - через `tasks` (список)
- Задача
  - задача с сотрудником - через `maker`
  - задача с должностью - через `maker_position` 
  - задача с дочерними задачами - через `child_tasks` (список)

### Отчетные выборки
Реализованы 2 отчетные выборки.

- **Занятые сотрудники**
  
  ```get('/services/busy_users')```

  Возвращает всех сотрудников, на которых назначены незакрытые задачи.
  Сортирует список по уменьшению занятости (сначала сотрудники у которых больше незакрытых задач).
  Для каждого сотрудника добавляет список его задач. 


- **Важные задачи**
  ```get('/services/important_tasks')```

  Отбирает задачи со статусом new, у которых есть дочерние задачи со статусом in work.
  
  К таким задачам подбирает наиболее подходящих для выполнения сотрудников:

  - ищет наименее загруженных сотрудников с подходящей должностью.
  Считает количество из задач (пусть будет N).
  - выбирает исполнителей дочерних задач, у которых статус in work.
  Среди них ищет тех, количество задач у которых не больше N + 2.
  Если такие сотрудники есть, наименее загруженные сотрудники далее не учитываются. 
  - если родительская задача была на кого-то назначена, этот сотрудник добавляется в список наиболее подходящих для выполнения задачи.
  
  Возвращает отобранные задачи, дополненные сроком реализации и списоком имен сотрудников, наиболее подходящих для выполнения задачи. 


### Документация

Подключена автоматически генерируемая api-документация swagger.
```
/docs/
```

### Тестирование

Код сервиса покрыт тестами pytest.

### Docker

- Описан Dockerfile для fastapi-приложения
- Создан docker-compose для всех сервисов, необходимых для запуска приложения
(fastapi-приложение, postgresql для основной БД, postgresql для тестовой БД)

<hr>

## Стэк технологий
<img src="https://img.shields.io/badge/python-134881?style=for-the-badge&logo=python&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/fastapi-134881?style=for-the-badge&logo=FastAPI&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/swagger-134881?style=for-the-badge&logo=swagger&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/alembic-134881?style=for-the-badge&logo=НАЗВАНИЕ ЛОГОТИПА&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/docker-134881?style=for-the-badge&logo=docker&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/docker compose-134881?style=for-the-badge&logo=НАЗВАНИЕ ЛОГОТИПА&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/pytest-134881?style=for-the-badge&logo=pytest&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/pydentic-134881?style=for-the-badge&logo=pydantic&logoColor=ffffff"/>
<img src="https://img.shields.io/badge/sqlalchemy-134881?style=for-the-badge&logo=sqlalchemy&logoColor=ffffff"/>
